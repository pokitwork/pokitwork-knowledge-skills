# 연차/휴가 관리

## 연차 유형 (Leave Type)

### 엔티티

- 이름 (고유): 연차, 반차, 반반차, 공가, 경조휴가 등
- 카테고리: 연차 | 기타
- 유급 여부
- 증빙서류 필수 여부
- 사유기재 필수 여부
- 차감 일수: 연차=1, 반차=0.5, 반반차=0.25, 기타=0
- 부여형 여부: 관리자가 특정 구성원에게 개별 부여하는 유형인지
- 최대 일수 (부여형인 경우, nullable)
- 최대 분할 횟수 (부여형인 경우, nullable)
- 정렬 순서

### 유형 분류

#### 연차 차감 유형

| 유형 | 차감일수 | 유급 | 증빙 |
|------|----------|------|------|
| 연차 | 1 | O | X |
| 반차(오전) | 0.5 | O | X |
| 반차(오후) | 0.5 | O | X |
| 반반차 | 0.25 | O | X |

#### 기타 유급 유형

| 유형 | 차감일수 | 증빙 | 비고 |
|------|----------|------|------|
| 공가 | 0 | O | 예비군, 민방위 |
| 경조휴가 | 0 | O | |
| 병가 | 0 | O | |
| 출산전후휴가 | 0 | O | |
| 포상휴가 | 0 | X | 부여형 — 관리자 부여 |
| 대체휴가 | 0 | X | 부여형 — 관리자 부여 |
| 배우자 출산휴가 | 0 | O | 최대 20일, 3회까지 분할 사용 가능 |

#### 기타 무급 유형

| 유형 | 차감일수 | 증빙 | 비고 |
|------|----------|------|------|
| 가족돌봄휴가 | 0 | X | |
| 여성보건휴가 | 0 | X | |
| 기타 휴가 | 0 | X | 사유기재 필수 |

### 비즈니스 규칙

- 카테고리가 "연차"인 유형만 연차 잔여일수에서 차감된다
- 기타 유형은 연차와 별도로 사용 가능하다 (잔여일수에 영향 없음)
- 부여형 유형(포상/대체)은 관리자가 특정 구성원에게 직접 부여해야 사용할 수 있다
- 드래그 앤 드롭으로 정렬 순서를 변경할 수 있다

## 연차 정책

### 공통 규칙 (근로기준법)

모든 연차 수치는 파생값이다. 별도 캐시 테이블 없이 매번 계산한다.

#### 1년 미만 또는 연간 소정근로 80% 미만

- 1개월 개근 시 1일 발생
- 최대 11일

#### 1년 이상 (80% 이상 출근)

- 15일 부여
- 3년차부터 매 2년마다 1일 추가
- 공식: `연차일수 = 15 + floor((근속연수 - 1) / 2)`
- 상한: 25일

| 근속기간 | 휴가일 | 근속기간 | 휴가일 |
|----------|--------|----------|--------|
| 1년 ~ 3년 미만 | 15일 | 11년 ~ 13년 미만 | 20일 |
| 3년 ~ 5년 미만 | 16일 | 13년 ~ 15년 미만 | 21일 |
| 5년 ~ 7년 미만 | 17일 | 15년 ~ 17년 미만 | 22일 |
| 7년 ~ 9년 미만 | 18일 | 17년 ~ 19년 미만 | 23일 |
| 9년 ~ 11년 미만 | 19일 | 19년 ~ 21년 미만 | 24일 |
| | | 21년 이상 | 25일 |

### 계산 방식 A: 입사일 기준 (구현 완료)

기준 주기: **입사 기념일 단위**

#### 1년 미만

- 입사일로부터 매월 1일씩 발생 (최대 11일)

#### 만 1년 도래 시

- 입사 1주년 되는 날 15일 발생
- 1년 미만 월차(11일)와 별도로 발생한다

#### 이후

- 매 입사 기념일에 근속연수에 따른 일수 발생

#### 예시 (2026.7.1 입사)

| 시점 | 발생 | 누계 |
|------|------|------|
| 2026.8.1 | +1 | 1 |
| 2026.9.1 | +1 | 2 |
| 2026.10.1 | +1 | 3 |
| 2026.11.1 | +1 | 4 |
| 2026.12.1 | +1 | 5 |
| 2027.1.1 | +1 | 6 |
| 2027.2.1 | +1 | 7 |
| 2027.3.1 | +1 | 8 |
| 2027.4.1 | +1 | 9 |
| 2027.5.1 | +1 | 10 |
| 2027.6.1 | +1 | 11 |
| 2027.7.1 (1주년) | +15 | 26 |

### 계산 방식 B: 회계연도 기준 (구현 완료)

기준 주기: **1월 1일 ~ 12월 31일**

#### 입사 첫해

- 매월 1일씩 발생 (입사일 기준과 동일)

#### 다음 해 1월 1일

- 전년도 근무일수에 비례하여 발생
- 공식: `15 × 입사첫해근무일수 / 365`
- 소수점 이하 0.25 단위로 올림

#### 2번째 완전 근무연도부터

- 매년 1월 1일에 15일 + 가산일 부여
- 가산 시작: 3년차 (입사일 기준과 동일 공식)

#### 예시 (2026.7.1 입사)

| 시점 | 계산 | 발생 |
|------|------|------|
| 2026.8.1 ~ 2026.12.1 | 월차 | 5일 |
| 2027.1.1 | 15 × 184/365 = 7.56 → 올림 | 7.75일 |
| 2027.2.1 ~ 2027.6.1 | 월차 | 5일 |
| 2028.1.1 | 15일 (2년차) | 15일 |
| 2029.1.1 | 15 + 1 = 16일 (3년차) | 16일 |

> 2026.7.1 ~ 2026.12.31 = 184일 (초일 산입)

### 시스템 설정

- 회사별로 계산 방식(A 또는 B)을 선택한다 (구현 완료)
- `leave_settings` 테이블에 `annual_leave_method` 컬럼으로 관리
- 관리자 설정 페이지(`/admin/settings`)에서 변경 가능

### 연차 일수 구성

- **총 일수** = 계산 방식에 따른 자동 계산
- **조정 일수** = 조정 이력 합산 (관리자가 +/- 조정)
- **사용 일수** = 승인된 연차차감 유형 사용 이력 합산
- **잔여 일수** = 총 일수 + 조정 일수 - 사용 일수

### 연차 조정

- 관리자가 특정 구성원의 연차를 +/- 조정할 수 있다
- 조정 사유를 필수로 기록한다
- 조정 이력은 누적 관리된다

## 부여형 휴가 (Granted Leave)

### 엔티티

- 대상 구성원
- 연차 유형 (포상휴가, 대체휴가 등 부여형 유형만)
- 부여 일수
- 사용 일수 (파생값: 승인된 사용 이력 합산)
- 잔여 일수 (파생값: 부여 - 사용)
- 만료일 (nullable)
- 부여 사유
- 부여자 (관리자)

### 비즈니스 규칙

- 관리자가 특정 구성원에게 부여형 유형의 휴가를 직접 생성한다
- 부여된 일수 범위 내에서만 사용 신청 가능하다
- 연차 잔여일수와 별도로 관리된다 (연차 차감 아님)
- 포상휴가/대체휴가: 증빙서류 불필요
- 배우자 출산휴가: 최대 20일, 3회까지 분할 사용 가능
  - 분할 횟수는 해당 부여 건에 대한 승인된 사용 이력 수로 추적한다

## 연차 신청 (Leave Usage)

### 엔티티

- 신청자 (구성원)
- 연차 유형
- 부여형 참조 (부여형 유형인 경우, nullable)
- 시작일, 종료일
- 사용 일수
- 상태: 승인 | 대기 | 반려
- 사유, 메모

### 비즈니스 규칙

- 신청 시 결재선 기반으로 결재 요청이 자동 생성된다
- 결재 승인 시 사용 일수가 차감된다
- 연차차감 유형: 잔여일수 확인 후 신청
- 부여형 유형: 해당 부여 건의 잔여일수 확인 후 신청
- 기타 유형: 일수 제한 없이 신청

## 연차사용촉진제 (Leave Usage Promotion)

### 비즈니스 규칙 (근로기준법 제61조)

#### 1차 촉진

- 시기: 연차 사용 기간 만료 6개월 전
- 대상: 미사용 연차가 있는 구성원
- 절차: 미사용 일수를 통보하고, 사용 시기를 지정하여 제출하도록 요청
- 기한: 통보 후 10일 이내 사용 계획서 제출

#### 2차 촉진

- 시기: 1차 촉진 기한 경과 후 (미제출 또는 미사용 시)
- 절차: 회사가 사용 시기를 서면으로 지정하여 통보
- 기한: 사용 기간 만료 2개월 전까지 통보

#### 효과

- 촉진 절차를 완료하면 미사용 연차에 대한 보상 의무가 면제된다
- 촉진 이력을 기록으로 관리한다

### 향후 계획

- 관리자 대시보드에서 촉진 대상자 자동 식별 및 알림
- 1차/2차 촉진 문서 자동 생성 및 발송
- 촉진 이력 조회

## 휴직 (Leave of Absence)

### 엔티티

- 신청자 (구성원)
- 유형: 육아 | 질병 | 가족돌봄 | 기타
- 시작일, 종료일 (복직일 미정 가능)
- 상태: 신청 → 승인 → 휴직중 → 복직 (또는 반려)
- 사유, 메모

### 유형별 상세

| 유형 | 기간 | 비고 |
|------|------|------|
| 육아휴직 | 최대 1년 (자녀 8세 이하) | 남녀 모두 사용 가능 |
| 질병휴직 | 회사 규정에 따름 | 진단서 필요 |
| 가족돌봄휴직 | 연 최대 90일 | 긴급돌봄 포함 |
| 기타휴직 | 회사 규정에 따름 | 사유 기재 필수 |

### 비즈니스 규칙

- 휴직은 연차와 별개 도메인이다 (월~년 단위)
- 승인 시 구성원 상태가 "휴직"으로 변경된다
- 복직 시 구성원 상태가 "재직"으로 복원된다

## 첨부파일

- 연차 신청 및 휴직 신청에 증빙서류를 첨부할 수 있다
- 연차차감 유형과 무급휴가는 증빙 불필요
- 포상휴가/대체휴가는 증빙 불필요 (관리자 부여)
- 상신 후에도 추가 보완 가능

## 향후 계획

- 연차사용촉진제 자동화 (알림, 문서 생성, 이력 관리)
- 통계 대시보드 (부서별/월별 사용 현황)
- 연차 소멸/이월 정책
- 휴가 사용률 개인 통계

## 스키마

[DB 스키마 다이어그램](leave-schema.md)
