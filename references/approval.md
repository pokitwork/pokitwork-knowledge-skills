# 결재관리

## 결재선 규칙 (Approval Chain Rule)

### 엔티티

- 부서 (부서당 1개)
- 결재자 목록 (순서 보장)

### 비즈니스 규칙

- 부서별로 결재선을 설정한다
- 결재자는 순서대로 배치된다 (1차 결재자, 2차 결재자, ...)
- 결재선이 없는 부서의 구성원은 연차 신청 시 결재 없이 처리될 수 있다
- 빈 결재자 목록으로 설정하면 결재선이 삭제된다

### PM 결재

- 프로젝트 수행인원이 결재 요청 시, 부서 결재선에 더해 프로젝트 PM이 추가 결재자로 지정된다
- 결재 순서: 팀장(부서 결재선) → PM (프로젝트 기반)
- PM이 부서 결재선에 이미 포함된 경우 중복 추가하지 않는다

## 결재 요청 (Approval Request)

### 엔티티

- 신청자 (구성원)
- 유형: 연차 | 지출 | 출장 | 경조사 | 교육
- 제목, 설명
- 상태: 임시보관 | 대기 | 진행중 | 완료 | 반려
- 유형별 부가 정보:
  - 연차/출장: 시작일, 종료일, 일수
  - 지출/출장/경조사/교육: 금액
  - 출장: 목적지
  - 경조사: 경조사 유형
  - 교육: 교육명, 교육기관
- 프로젝트 (nullable — PM 결재 연동)
- 메모
- 첨부파일
- 수신참조 대상자 목록

### 상태 전환

```
임시보관 → 대기 (상신)
대기 → 진행중 (1차 결재자 확인)
진행중 → 완료 (모든 결재자 승인)
대기/진행중 → 반려 (결재자 반려)
```

### 비즈니스 규칙

- 연차 신청 시 결재 요청이 자동 생성된다
- 결재는 결재선 순서대로 진행된다 (1차 → 2차 → ...)
- 앞 단계가 승인되어야 다음 단계가 활성화된다
- 한 단계에서 반려되면 전체 요청이 반려된다

### 임시보관 (Draft)

- 작성 중인 문서를 임시보관할 수 있다
- 임시보관 상태에서는 결재가 시작되지 않는다
- 상신 전까지 수정/삭제 가능하다
- 문서함에서 임시보관 문서를 조회할 수 있다

### 메모 및 첨부파일

- 메모: 상신 후에도 보완 설명을 추가할 수 있다
- 첨부파일: 상신 후에도 증빙서류를 추가 보완할 수 있다

## 결재 단계 (Approval Step)

### 엔티티

- 결재 요청
- 결재자 (구성원)
- 순서
- 상태: 대기 | 승인 | 반려
- 코멘트
- 처리 일시

## 수신참조 (Approval CC)

### 비즈니스 규칙

- 결재 요청 생성 시 수신참조 대상이 자동으로 추가된다
- 자동 추가 대상: 임원 + 경영지원팀 소속 구성원
- 수신참조 대상자는 결재 요청 내용을 열람할 수 있지만 승인/반려 권한은 없다
- 신청자가 수동으로 수신참조를 추가할 수도 있다

## 알림

### 비즈니스 규칙

- 결재 요청 시 결재자에게 알림이 발송된다
- 결재 요청 시 수신참조 대상자에게도 알림이 발송된다
- 승인/반려 시 신청자에게 알림이 발송된다

## 향후 계획

- 전자결재 확대: 일반 기안문, 보고서, 지출결의서, 출장신청서, 야근신청서
- 결재 템플릿 관리
- 결재 통계 및 처리 시간 분석

## 스키마

[DB 스키마 다이어그램](approval-schema.md)
